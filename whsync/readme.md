# Схема `whsync`

## **Таблица `OrderCache`**
##### Используется для хранения информации для последующей передачи через функцию Order_export

| Поле            | Тип данных     | Ограничения | Описание                                     |
| --------------- | -------------- |-------------| --------------------------------------------- |
| log_id          | BIGSERIAL      | NOT NULL    | Уникальный идентификатор записи        |
| order_id        | BIGINT         | NOT NULL    | Идентификатор заказа                          |
| total_price     | NUMERIC(15, 2) | NOT NULL    | Общая стоимость заказа                        |
| payment_type    | VARCHAR(20)    | NOT NULL    | Тип оплаты                                   |
| menu            | JSONB          | NOT NULL    | JSON-объект с информацией о выбранных блюдах   |
| card_number     | VARCHAR(16)    | NOT NULL    | Номер карты для оплаты                        |
| desk_id         | INTEGER        | NOT NULL    | Идентификатор столика                         |
| sync_dt         | TIMESTAMPTZ    |             | Дата и время синхронизации с базой данных     |
| ch_employee_id  | INTEGER        | NOT NULL    | Идентификатор сотрудника, вносящего изменения   |
| ch_dt           | TIMESTAMPTZ    | NOT NULL    | Дата и время внесения изменений                |

***Примечания:***
- Поле menu типа JSON описывается в документации схемы `restaurant`

## **Таблица `PurchaseCache`**
##### Используется для хранения информации для последующей передачи через функцию Purchase_export

| Поле            | Тип данных     | Ограничения    | Описание                                     |
| --------------- | -------------- |----------------| --------------------------------------------- |
| log_id          | BIGSERIAL      | NOT NULL       | Уникальный идентификатор записи        |
| purchase_id     | INTEGER        | NOT NULL       | Идентификатор закупки                         |
| details         | JSONB          |                | JSON-объект с дополнительными деталями          |
| supplier_id     | INTEGER        | NOT NULL       | Идентификатор поставщика                       |
| is_approved     | BOOLEAN        | NOT NULL       | Флаг утверждения заказа                        |
| order_date      | DATE           | NOT NULL       | Дата заказа                                   |
| delivery_date   | DATE           |                | Дата доставки                                 |
| sync_dt         | TIMESTAMPTZ    |                | Дата и время синхронизации с базой данных     |
| ch_employee_id  | INTEGER        | NOT NULL       | Идентификатор сотрудника, вносящего изменения   |
| ch_dt           | TIMESTAMPTZ    | NOT NULL       | Дата и время внесения изменений                |

***Примечания:***
- Поле details типа JSON описывается в документации схемы `restaurant`

## **Функция `Order_import`**
- Используется для принятия данных из другой БД, при вызове функции данные записываются в таблицу Order и OrderChanges

## **Функция `Order_export`**
- Используется для отправки данных в другую БД, при вызове функции данные из таблицы OrderCache выводятся в формате JSON и таблица очищается

## **Функция `Purchase_import`**
- Используется для принятия данных из другой БД, при вызове функции данные записываются в таблицу Purchase и PurchaseChanges

## **Функция `Purchase_export`**
- Используется для отправки данных в другую БД, при вызове функции данные из таблицы PurchaseCache выводятся в формате JSON и таблица очищается