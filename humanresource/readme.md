# Схема `humanresource`

## **Таблица `Client`**
##### Используется для хранения информации о клиенте
| Поле           | Тип данных   | Ограничения | Описание                                     |
| -------------- | ------------ | ----------- | -------------------------------------------- |
| client_id      | INTEGER      | NOT NULL    | Уникальный идентификатор клиента |
| name           | VARCHAR(200) | NOT NULL    | Имя клиента                                  |
| phone          | VARCHAR(11)  | NOT NULL    | Номер телефона клиента                       |
| card_number    | VARCHAR(16)  | NOT NULL    | Номер карты клиента                          |
| ch_employee_id | INTEGER      | NOT NULL    | Идентификатор сотрудника, осуществившего изменение клиента |
| ch_dt          | TIMESTAMPTZ  | NOT NULL    | Дата и время изменения клиента                |

***Примечания:***
- Логируемая таблица

## **Таблица `Employee`**
##### Используется для хранения информации о сотруднике
| Поле           | Тип данных   | Ограничения | Описание                                                |
| -------------- | ------------ | ----------- |---------------------------------------------------------|
| employee_id    | INTEGER      | NOT NULL    | Уникальный идентификатор сотрудника       |
| name           | VARCHAR(200) | NOT NULL    | Имя сотрудника                                          |
| phone          | VARCHAR(11)  | NOT NULL    | Номер телефона сотрудника                               |
| birth          | DATE         | NOT NULL    | Дата рождения сотрудника                                |
| position_id    | INTEGER      | NOT NULL    | Идентификатор должности сотрудника                      |
| is_delete      | BOOLEAN      | NOT NULL    | Статус удаления сотрудника                              |
| ch_employee_id | INTEGER      | NOT NULL    | Идентификатор сотрудника, осуществившего изменение данных |
| ch_dt          | TIMESTAMPTZ  | NOT NULL    | Дата и время изменения данных сотрудника                |

***Примечания:***
- Логируемая таблица

## **Таблица `Supplier`**
##### Используется для хранения информации о поставщике ингредиентов
| Поле         | Тип данных   | Ограничения   | Описание                                      |
| ------------ | ------------ |---------------| --------------------------------------------- |
| supplier_id  | INTEGER      | NOT NULL      | Уникальный идентификатор поставщика            |
| name         | VARCHAR(100) | NOT NULL      | Название поставщика                            |
| phone        | VARCHAR(11)  | NOT NULL      | Номер телефона поставщика                      |
| email        | VARCHAR(50)  | NOT NULL      | Электронная почта поставщика                   |
| inn          | VARCHAR(12)  | NOT NULL      | ИНН (Идентификационный номер налогоплательщика) |

## **Функция `Client_upd`**
Пример вызова функции:

```sql
SELECT humanresource.client_upd('
                                {
                                  "client_id": 48,
                                  "name": "Гребенников Максим Сергеевич",
                                  "phone": "89123456111",
                                  "card_number": "5678950286742543"
                                }
                                ', 1111);
```
***Примечания:***
- Если уже существует запись с таким же идентификатором id, то данные заменяются на входящие

Результат успешного выполнения функции:
```json
{"data": null}
```

Результат выполнения с ошибкой(такой клиент уже существует):
```json
{
  "errors": [
    {
      "error": "humanresource.client_upd.duplicate",
      "detail": "",
      "message": "Такая запись уже существует!"
    }
  ]
}
```

## **Функция `Employee_upd`**
Пример вызова функции:

```sql
SELECT humanresource.employee_upd('
                                  {
                                    "employee_id": "51",
                                    "name": "Зубенко Михаил Петрович",
                                    "phone": "88005553535",
                                    "birth": "1993-5-11",
                                    "position_id": "6",
                                    "is_delete": "true"
                                  }
                                  ', 1111);
```
***Примечания:***
- Если уже существует запись с таким же идентификатором id, то данные заменяются на входящие

Результат успешного выполнения функции:
```json
{"data": null}
```

## **Функция `Employee_upd`**
Пример вызова функции:

```sql
SELECT humanresource.employee_upd('
                                  {
                                    "employee_id": "51",
                                    "name": "Зубенко Михаил Петрович",
                                    "phone": "88005553535",
                                    "birth": "1993-5-11",
                                    "position_id": "6",
                                    "is_delete": "true"
                                  }
                                  ', 1111);
```
***Примечания:***
- Если уже существует запись с таким же идентификатором id, то данные заменяются на входящие

Результат успешного выполнения функции:
```json
{"data": null}
```

## **Функция `Supplier_upd`**
Пример вызова функции:

```sql
SELECT humanresource.supplier_upd('
{
  "supplier_id": "54",
  "name": "ИП Жорино",
  "phone": "89992358208",
  "email": "jor1192@gmail.com",
  "inn": "421456789056"
}');
```
Результат успешного выполнения функции:
```json
{"data": null}
```

Результат выполнения с ошибкой(такой номер телефона уже существует):
```json
{
  "errors": [
    {
      "error": "humanresource.supplier_upd.phone_duplicate",
      "detail": "",
      "message": "Этот номер телефона уже есть у поставщика!"
    }
  ]
}
```

## **Функция `Client_getInfo`**
Пример вызова функции:

```sql
SELECT humanresource.client_getinfo(48, NULL, NULL);
```
***Примечания:***
* Присутствуют фильтры для полей: client_id, phone, card_number

Результат успешного выполнения функции:
```json
{
  "data": [
    {
      "name": "Гребенников Максим Сергеевич",
      "phone": "89123456111",
      "client_id": 48,
      "card_number": "5678950286742543"
    }
  ]
}
```

## **Функция `Employee_getInfo`**
Пример вызова функции:

```sql
SELECT humanresource.client_getinfo(48, NULL, NULL);
```
***Примечания:***
* Присутствуют фильтры для полей: employee_id, phone, position_id

Результат успешного выполнения функции:
```json
{
  "data": [
    {
      "name": "Зубенко Михаил Петрович",
      "birth": "1993-05-11",
      "phone": "88005553535",
      "is_delete": true,
      "employee_id": 51,
      "position_id": 6
    }
  ]
}
```

## **Функция `Supplier_getInfo`**
Пример вызова функции:

```sql
SELECT humanresource.supplier_getinfo(54, NULL);
```
***Примечания:***
* Присутствуют фильтры для полей: supplier_id, phone

Результат успешного выполнения функции:
```json
{
  "data": [
    {
      "inn": "421456789056",
      "name": "ИП Жорино",
      "email": "jor1192@gmail.com",
      "phone": "89992358208",
      "supplier_id": 54
    }
  ]
}
```
